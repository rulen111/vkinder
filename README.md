# VKinder
VKinder Бот
Это скрипт на Python, который использует API VK для взаимодействий. VKinder Бот помогает пользователям найти потенциальную пару для знакомства на сайте ВКонтакте (VK) на основе указанных предпочтений.

## Описание func/bot.py

Предварительные требования
Перед запуском бота убедитесь, что у вас установлены следующие зависимости:

* vk_api
* yaml


### Настройка

Для настройки бота необходим файл **_config.yaml_**. Убедитесь, что у вас правильно установлены следующие параметры:

**VK.VERSION**: Версия API VK, которую необходимо использовать.<br/>
**VK.APP_ID**: Ваш идентификатор самостоятельного приложения (или введите его интерактивно, если не установлен).<br/>
**VK.GROUP_TOKEN**: Токен доступа к группе VK (или введите его интерактивно, если не установлен).<br/>
**VK.GROUP_ID**: Идентификатор группы VK (или введите его интерактивно, если не установлен).<br/>
**VK.USER_TOKEN**: Токен пользователя для API VK.

## Использование

Убедитесь, что файл **_config.yaml_** правильно настроен.
Запустите скрипт.

Бот использует файлы JSON для макетов. Предоставлены следующие макеты:

**keyboard_main.json**: Основной макет.<br/>
**keyboard_choose.json**: Для выбора предпочтений.<br/>
**keyboard_search.json**: Для функции поиска.<br/>
**keyboard_empty.json**: Пустой макет.<br/>
**keyboard_settings.json**: Для настроек.<br/>
**keyboard_authorize.json**: Для авторизации.<br/>
**keyboard_list_fav.json**: Для списка избранных.<br/>
**keyboard_list_fav_gallery.json**: Для списка избранных в виде галереи.<br/>

## Логирование

Бот регистрирует события и ошибки в файлы в каталоге **_logs/_**. Каждый файл журнала назван по дате.

### Функциональность

**logger**: Декоратор для регистрации вызовов функций.<br/>
**api_handler**: Декоратор для перехвата ошибок VK API.<br/>
**update_config**: Функция для обновления данных конфигурации в файле config.yaml.<br/>

## VKhandler

Это класс для обработки **_Longpoll_**. Обрабатывает поступающие события бота.

## Методы

**init_user_client**: Этот метод обрабатывает инициализацию объекта VKClient для использования с пользовательским токеном. Принимает токен в качестве аргумента и устанавливает его в user_client.<br/>
**start**: Обрабатывает событие "start". При вызове этого метода бот отправляет сообщение, объясняющее пользователю, как начать работу с ботом.<br/>
**token**: Обрабатывает событие "token". Метод получает токен, введенный пользователем, и инициализирует user_client. Если токен успешно установлен, он записывается в конфигурационный файл.<br/>
**random_msg**: Обрабатывает событие "random_msg". Этот метод отправляет случайное сообщение пользователю, предлагая в случае пропажи клавиатуры написать слово "Начать".<br/>
**main_menu**: Обрабатывает событие "main_menu". Этот метод выводит главное меню пользователю.<br/>
**search**: Обрабатывает событие "search". Метод инициирует процесс поиска, запрашивая у пользователя подтверждение поисковых параметров.<br/>
**search_start**: Обрабатывает событие "search_start". Этот метод запускает процесс поиска на основе указанных пользовательских параметров.<br/>
**rotation**: Обрабатывает событие "rotation". Метод отображает профиль пользователя из результатов поиска и предоставляет возможность просмотра следующего профиля.<br/>
**next_person**: Обрабатывает событие "next_person". Этот метод перемещается к следующему профилю в результате поиска.<br/>
**show_help**: Обрабатывает событие "show_help". Данный метод выводит справочную информацию.<br/>
**settings**: Обрабатывает событие "settings". Метод предоставляет пользователю возможность изменить настройки.<br/>
**change_city**: Обрабатывает событие "change_city". Этот метод инициирует процесс изменения города пользователя.<br/>
**change_city_value**: Обрабатывает событие "change_city_value". Метод изменяет город пользователя на указанный.<br/>
**change_age**: Обрабатывает событие "change_age". Этот метод инициирует процесс изменения возраста пользователя.<br/>
**change_age_value**: Обрабатывает событие "change_age_value". Метод изменяет возраст пользователя на указанный.<br/>
**change_sex**: Обрабатывает событие "change_sex". Этот метод инициирует процесс изменения пола пользователя.<br/>
**change_sex_value**: Обрабатывает событие "change_sex_value". Метод изменяет пол пользователя на указанный.<br/>
**add_to_fav**: Обрабатывает событие "add_to_fav". Метод добавляет профиль пользователя в список избранного.<br/>
**list_fav**: Обрабатывает событие "list_fav". Метод выводит список избранных профилей пользователю.<br/>
**list_fav_list**: Обрабатывает событие "list_fav_list". Метод выводит список избранных профилей пользователю списком.<br/>
**list_fav_gallery**: Обрабатывает событие "list_fav_gallery". Метод выводит список избранных профилей пользователю в виде галереи.<br/>
**fav_gallery_next**: Обрабатывает событие "fav_gallery_next". Метод отображает следующий профиль из избранного.<br/>
**start_polling**: Запускает процесс приема и обработки событий от серверов VK. Итерируется по каждому входящему событию и вызывает соответствующий обработчик.<br/>

## Работа с БД

Данный проект представляет собой набор классов и функций для работы с базой данных пользователей и их избранных в социальной сети VKontakte (VK).

### Структура базы данных

Проект использует базу данных, организованную с использованием SQLAlchemy. В базе данных есть следующие таблицы:

**Favourite**: Хранит информацию о пользователях, добавленных в избранное.<br/>
**Client**: Содержит информацию о клиентах, включая их параметры поиска и город проживания.<br/>
**Client_Favourite**: Эта таблица устанавливает отношение "многие ко многим" между клиентами и их избранными пользователями.<br/>
**City**: Хранит информацию о городах.<br/>

## Описание классов

**Favourite**: Класс описывает модель избранного пользователя VK.<br/>
**Client**: Представляет модель клиента с параметрами поиска и городом проживания.<br/>
**Client_Favourite**: Модель представляет собой ассоциативную таблицу для установления отношения "многие ко многим" между клиентами и их избранными пользователями.<br/>
**City**: Представляет модель города.<br/>

## Функции работы с базой данных

**create_tables(engine)**: Создает все таблицы в базе данных, используя определенную структуру.<br/>
**drop_tables(engine)**: Удаляет все таблицы из базы данных.<br/>
**add_fav_entry(session, client_user_id, user_id, first_name, last_name, attachment)**: Добавляет запись об избранном пользователе в базу данных.<br/>
**get_fav_list(session, client_id)**: Получает список избранных пользователей для указанного клиента.<br/>
**add_client_info(session, user_id, age_from, age_to, sex, city)**: Добавляет информацию о клиенте в базу данных.<br/>
**get_client_info(session, user_id)**: Получает информацию о клиенте по его идентификатору.<br/>
**add_city_entry(session, city_id, name)**: Добавляет информацию о городе в базу данных.<br/>
**get_city_entry(session, city_id, name=None)**: Получает информацию о городе по его идентификатору или названию.<br/>
